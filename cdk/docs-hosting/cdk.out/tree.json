{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.232.1"},"children":{"DocsHosting-spacetimecards-docs":{"id":"DocsHosting-spacetimecards-docs","path":"DocsHosting-spacetimecards-docs","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.232.1"},"children":{"DocsBucket":{"id":"DocsBucket","path":"DocsHosting-spacetimecards-docs/DocsBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.232.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DocsHosting-spacetimecards-docs/DocsBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketName":"docs-spacetimecards-docs-spacetimecards-com","publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}]}}},"Policy":{"id":"Policy","path":"DocsHosting-spacetimecards-docs/DocsBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.232.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DocsHosting-spacetimecards-docs/DocsBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"DocsBucketECEA003F"},"policyDocument":{"Statement":[{"Action":["s3:PutBucketPolicy","s3:GetBucket*","s3:List*","s3:DeleteObject*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["DocsBucketECEA003F","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["DocsBucketECEA003F","Arn"]},"/*"]]}]},{"Action":"s3:GetObject","Condition":{"StringEquals":{"AWS:SourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":cloudfront::",{"Ref":"AWS::AccountId"},":distribution/",{"Ref":"Distribution830FAC52"}]]}}},"Effect":"Allow","Principal":{"Service":"cloudfront.amazonaws.com"},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["DocsBucketECEA003F","Arn"]},"/*"]]}}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"DocsHosting-spacetimecards-docs/DocsBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.232.1","metadata":[]},"children":{"Default":{"id":"Default","path":"DocsHosting-spacetimecards-docs/DocsBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.232.1"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"DocsHosting-spacetimecards-docs/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.232.1"},"children":{"Staging":{"id":"Staging","path":"DocsHosting-spacetimecards-docs/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.232.1"}},"Role":{"id":"Role","path":"DocsHosting-spacetimecards-docs/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.232.1"}},"Handler":{"id":"Handler","path":"DocsHosting-spacetimecards-docs/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.232.1"}}}},"SsmParameterValue:--thecompany--docs-password:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter":{"id":"SsmParameterValue:--thecompany--docs-password:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","path":"DocsHosting-spacetimecards-docs/SsmParameterValue:--thecompany--docs-password:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.232.1"}},"SsmParameterValue:--thecompany--docs-password:C96584B6-F00A-464E-AD19-53AFF4B05118":{"id":"SsmParameterValue:--thecompany--docs-password:C96584B6-F00A-464E-AD19-53AFF4B05118","path":"DocsHosting-spacetimecards-docs/SsmParameterValue:--thecompany--docs-password:C96584B6-F00A-464E-AD19-53AFF4B05118","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}},"AuthFunction":{"id":"AuthFunction","path":"DocsHosting-spacetimecards-docs/AuthFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.experimental.EdgeFunction","version":"2.232.1","metadata":[]},"children":{"Fn":{"id":"Fn","path":"DocsHosting-spacetimecards-docs/AuthFunction/Fn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.232.1","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"DocsHosting-spacetimecards-docs/AuthFunction/Fn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.232.1","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"DocsHosting-spacetimecards-docs/AuthFunction/Fn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}},"Resource":{"id":"Resource","path":"DocsHosting-spacetimecards-docs/AuthFunction/Fn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}},{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"edgelambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"Resource":{"id":"Resource","path":"DocsHosting-spacetimecards-docs/AuthFunction/Fn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":{"Fn::Join":["",["'use strict';\n\n// Basic auth credentials - injected at deploy time\nconst USERNAME = 'docs';\nconst PASSWORD = '",{"Ref":"SsmParameterValuethecompanydocspasswordC96584B6F00A464EAD1953AFF4B05118Parameter"},"';\n\nexports.handler = async (event) => {\n  const request = event.Records[0].cf.request;\n  const headers = request.headers;\n\n  const authHeader = headers.authorization || headers.Authorization;\n\n  if (!authHeader || !authHeader[0]) {\n    return unauthorized();\n  }\n\n  const authValue = authHeader[0].value;\n  const encoded = authValue.split(' ')[1];\n\n  if (!encoded) {\n    return unauthorized();\n  }\n\n  const decoded = Buffer.from(encoded, 'base64').toString('utf-8');\n  const [user, pass] = decoded.split(':');\n\n  if (user === USERNAME && pass === PASSWORD) {\n    return request;\n  }\n\n  return unauthorized();\n};\n\nfunction unauthorized() {\n  return {\n    status: '401',\n    statusDescription: 'Unauthorized',\n    headers: {\n      'www-authenticate': [{ key: 'WWW-Authenticate', value: 'Basic realm=\"Documentation\"' }],\n      'content-type': [{ key: 'Content-Type', value: 'text/html' }],\n    },\n    body: '<html><body><h1>401 Unauthorized</h1><p>Authentication required.</p></body></html>',\n  };\n}\n"]]}},"description":"Basic auth for docs-spacetimecards-docs.spacetimecards.com","handler":"index.handler","role":{"Fn::GetAtt":["AuthFunctionFnServiceRole7FC4ADF4","Arn"]},"runtime":"nodejs20.x"}}},"CurrentVersion":{"id":"CurrentVersion","path":"DocsHosting-spacetimecards-docs/AuthFunction/Fn/CurrentVersion","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Version","version":"2.232.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DocsHosting-spacetimecards-docs/AuthFunction/Fn/CurrentVersion/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnVersion","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Version","aws:cdk:cloudformation:props":{"functionName":{"Ref":"AuthFunctionFn6ACB74A4"}}}}}}}}}},"Certificate":{"id":"Certificate","path":"DocsHosting-spacetimecards-docs/Certificate","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}},"Distribution":{"id":"Distribution","path":"DocsHosting-spacetimecards-docs/Distribution","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.Distribution","version":"2.232.1","metadata":[]},"children":{"Origin1":{"id":"Origin1","path":"DocsHosting-spacetimecards-docs/Distribution/Origin1","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"S3OriginAccessControl":{"id":"S3OriginAccessControl","path":"DocsHosting-spacetimecards-docs/Distribution/Origin1/S3OriginAccessControl","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.S3OriginAccessControl","version":"2.232.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DocsHosting-spacetimecards-docs/Distribution/Origin1/S3OriginAccessControl/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnOriginAccessControl","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::OriginAccessControl","aws:cdk:cloudformation:props":{"originAccessControlConfig":{"name":"DocsHostingspacetimecardsdocOrigin1S3OriginAccessControlEBF98968","signingBehavior":"always","signingProtocol":"sigv4","originAccessControlOriginType":"s3"}}}}}}}},"Resource":{"id":"Resource","path":"DocsHosting-spacetimecards-docs/Distribution/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnDistribution","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::Distribution","aws:cdk:cloudformation:props":{"distributionConfig":{"enabled":true,"origins":[{"domainName":{"Fn::GetAtt":["DocsBucketECEA003F","RegionalDomainName"]},"id":"DocsHostingspacetimecardsdocsDistributionOrigin179B95CB8","s3OriginConfig":{"originAccessIdentity":""},"originAccessControlId":{"Fn::GetAtt":["DistributionOrigin1S3OriginAccessControlEB606076","Id"]}}],"defaultCacheBehavior":{"pathPattern":"*","targetOriginId":"DocsHostingspacetimecardsdocsDistributionOrigin179B95CB8","cachePolicyId":"658327ea-f89d-4fab-a63d-7e88639e58f6","compress":true,"viewerProtocolPolicy":"redirect-to-https","lambdaFunctionAssociations":[{"lambdaFunctionArn":{"Ref":"AuthFunctionFnCurrentVersion9F5227985c328e03afda0c8e2a6e4ef3d9b47795"},"eventType":"viewer-request"}]},"aliases":["docs-spacetimecards-docs.spacetimecards.com"],"customErrorResponses":[{"errorCachingMinTtl":0,"errorCode":404,"responseCode":200,"responsePagePath":"/404.html"}],"defaultRootObject":"index.html","httpVersion":"http2","ipv6Enabled":true,"viewerCertificate":{"acmCertificateArn":"arn:aws:acm:us-east-1:291350102176:certificate/f68e3139-9b7a-4cfd-96fd-76abecbacebd","minimumProtocolVersion":"TLSv1.2_2021","sslSupportMethod":"sni-only"}}}}}}},"HostedZone":{"id":"HostedZone","path":"DocsHosting-spacetimecards-docs/HostedZone","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}},"AliasRecord":{"id":"AliasRecord","path":"DocsHosting-spacetimecards-docs/AliasRecord","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.ARecord","version":"2.232.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DocsHosting-spacetimecards-docs/AliasRecord/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.CfnRecordSet","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Route53::RecordSet","aws:cdk:cloudformation:props":{"aliasTarget":{"hostedZoneId":{"Fn::FindInMap":["AWSCloudFrontPartitionHostedZoneIdMap",{"Ref":"AWS::Partition"},"zoneId"]},"dnsName":{"Fn::GetAtt":["Distribution830FAC52","DomainName"]}},"hostedZoneId":"Z0595404SWETQJWLVLTO","name":"docs-spacetimecards-docs.spacetimecards.com.","type":"A"}}}}},"AWSCloudFrontPartitionHostedZoneIdMap":{"id":"AWSCloudFrontPartitionHostedZoneIdMap","path":"DocsHosting-spacetimecards-docs/AWSCloudFrontPartitionHostedZoneIdMap","constructInfo":{"fqn":"aws-cdk-lib.CfnMapping","version":"2.232.1"}},"BucketName":{"id":"BucketName","path":"DocsHosting-spacetimecards-docs/BucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"DistributionId":{"id":"DistributionId","path":"DocsHosting-spacetimecards-docs/DistributionId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"DocsUrl":{"id":"DocsUrl","path":"DocsHosting-spacetimecards-docs/DocsUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"CDKMetadata":{"id":"CDKMetadata","path":"DocsHosting-spacetimecards-docs/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Default":{"id":"Default","path":"DocsHosting-spacetimecards-docs/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.232.1"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"DocsHosting-spacetimecards-docs/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.232.1"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"DocsHosting-spacetimecards-docs/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.232.1"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"}}}}}